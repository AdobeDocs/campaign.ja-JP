---
title: SMPP 接続の検証
description: SMPP 接続を検証する方法を学ぶ
feature: SMS
role: User
level: Intermediate
badge: label="限定提供（LA）" type="Informative"
source-git-commit: dde669980493b996c80baacc8726db87353585ad
workflow-type: tm+mt
source-wordcount: '4445'
ht-degree: 16%

---


# SMPP 接続の検証 {#validate-smpp-connection}

SMPP 接続に問題がないことを確認するためのチェックを以下に示します。

## 運用開始前に確認すべき事項 {#check-go-live}

運用を開始する前に、以下のチェックのリストを使用して、SMPP 設定が正常であることを確認してください。

>[!IMPORTANT]
>
>このチェックリストは完全ではありません。 より多くのチェックをすればするほど、より良い。

>[!NOTE]
>
>チェック時に詳細 SMPP トレースを有効にすると、ユーザーおよびサポートチームがトラブルシューティングを理解するのに役立ちます。

### 外部アカウントの競合の確認 {#sms-external-accounts-check}

残りの SMS 外部アカウントがないことを確認します。 競合を排除するために、テストアカウントを削除します。

他のインスタンスが外部アカウントに接続していないことを確認します。 特に、実稼動環境が実稼動外部勘定に接続されていないことを確認してください。

同じプロバイダーに接続する同じ Campaign インスタンスに複数のアカウントが必要な場合は、プロバイダーに問い合わせて、これらのアカウント間の接続が実際に区別されていることを確認してください。 複数のアカウントに同じログインを割り当てる場合は、追加の設定が必要です。

有効なすべての SMS 外部アカウントで、専用のプロセス設定が有効になっていることを確認します。 同じインスタンスで、2 種類のアカウント（専用プロセスを使用する場合と使用しない場合）を混在させることはできません。

### 実際のテストを行う {#real-test}

別のモバイルでいくつかの SMS を送信してみてください。

**あらゆる種類の文字を使用して SMS を送信**

非 GSM 文字または非 ASCII 文字で SMS を送信する必要がある場合は、可能な限り多様な文字を使用してメッセージを送信してみてください。 カスタム文字マッピングテーブルを設定する場合、可能なすべての data_coding 値に対して少なくとも 1 つの SMS を送信します。

**SR が正しく処理されていることを確認する**

SMS は、配信ログで受信済みとしてマークされる必要があります。 配信ログが正常に終了します。内容は「*SR yourProvider stat=DELIVRD err=000|#MESSAGE#*」のようになります。

「*SMSC 実装名*」フィールドを正しく設定していることを確認します。実稼動環境では配信ログに「*SR 汎用*」を含めないでください。

**MO が処理されていることを確認**

すべての自動返信キーワードに対していくつかの SMS を送信し、返信が高速（数秒以内）であることを確認します。

MO が *nms:inSms* データベースに挿入されていることを確認します。 カスタム TLV がある場合は、それらが正しく挿入され、正しくフォーマットされていることを確認します。

Campaign が成功 *DELIVER_SM_RESP （command_status=0）* を返したことをログで確認します。

**負荷テストを行う**

これは、大量のメッセージを送信する場合や、リアルタイムメッセージを使用する場合に特に重要です。

接続を 100% で読み込むテストを 5 秒以上実行します。 プロバイダーがテストのために偽のアカウントに接続する方法がない場合は、実際のメッセージを送信する必要があります。 これを実現するには、最初の十分大きな配信を詳細に監視し、詳細 SMPP メッセージを有効にします。

送信するメッセージの最小数は、次のように計算できます。

*最大 MT スループット * トランスミッター/トランシーバー接続の合計数* 5*

配信が完了したら、次の点を確認します。

* すべてのメッセージが送信されたことを確認します（受信した場合もあります）
* 通常の操作としてプロバイダーから明示的に指定されない限り、command_status が 0x00000000 ではない PDU は絶対に 0 である必要があります
* 接続は、配信プロセス全体を通じて絶対的に安定している（BIND PDU がない）必要があります。
* すべてのメッセージに SR があり、それが正しく処理されていることを確認します（[SR が正しく処理されていることを確認 ](#real-test)）。 エラーの割合が少ない場合は、Campaign 側での送信時や処理中のエラーではなく、実際の SR でエラーを返していることを確認します。
* パフォーマンスが不明な場合は、待ち時間（特に PDU とそれに対応する RESP の間）が妥当であることを確認します。500 ミリ秒を超える待ち時間は、高スループットの問題となる可能性があります。 その待ち時間を使用して、送信ウィンドウの式を確認します（詳しくは、送信ウィンドウの設定を参照）

### PDU の確認 {#pdu}

PDU が正しくフォーマットされていることを確認します。

>[!IMPORTANT]
>
>これまで Campaign に接続していなかったプロバイダーに接続する場合は、この手順を実行することを強くお勧めします。

**BIND**

BIND_* PDU が正しく送信されていることを確認します。 最も重要なチェック事項は、プロバイダーが常に成功した BIND_*_RESP PDU （command_status = 0）を返すことです。

BIND_* PDU が多すぎないことを確認します。 これらの数が多すぎる場合は、接続が不安定であることを示している可能性があります。 詳しくは、以下の不安定な接続に関する問題のトラブルシューティングの節を参照してください。

**ENQUIRE_LINK**

接続がアイドル状態の場合に ENQUIRE_LINK PDU が定期的に交換されていることを確認します。

**SUBMIT_SM / DELIVER_SM**

メッセージを送信し、ログで対応する SUBMIT_SM、SUBMIT_SM_RESP、DELIVER_SM、DELIVER_SM_RESP PDU を検索します。

*SUBMIT_SM PDU* を使用した場合：

* data_coding が正しいことを確認します（デフォルトでは 0）。
* short_message が適切にエンコードされていることを確認します。複数のエンコードをサポートする 16 進数コンバーターを使用してデコードしてみてください（オンラインで使用できるコードがいくつかあります）。
* 長いメッセージに message_payload を使用する場合は、そのコンテンツが short_message フィールドではなく、オプションのフィールドに存在することを確認します。

*SUBMIT_SM_RESP PDU* を使用した場合：

* 成功したことを確認します（command_status = 0）。
* 本文で、適切にフォーマットされた ID の後に「0」バイトが続くことを確認します。

*DELIVER_SM PDU* の場合：

* 16 進 short_message フィールドをデコードします（そのためのオンラインツールがあります）。
* 正規表現チェックツールで、SR 内の ID の抽出正規表現で定義されている正規表現によって 1 つのキャプチャグループのみが返され、メッセージ内の ID 全体がキャプチャされることを確認します。
* 抽出された ID が SUBMIT_SM_RESP の ID と一致することを確認します。
* SR 内のステータスの抽出正規表現で定義されている正規表現が、統計フィールドの内容を返すことを確認します。
* SR でエラーの抽出正規表現で定義されている正規表現が、err フィールドの内容を返すことを確認します。

*DELIVER_SM_RESP PDU* を使用した場合：

* DELIVER_SM PDU を受信した後、すぐに送信されたかどうかを確認します（通常、1 秒未満）。
* 成功したことを確認します（command_status = 0）。

### プロバイダーでのライブテスト {#sms-live-test}

運用開始のベストプラクティスは、プロバイダーを使用してライブテストを行い、双方の関係者が実行中にログを確認することです。

>[!IMPORTANT]
>
>これまで Campaign に接続したことがないプロバイダーに接続する場合は、この手順を実行することを強くお勧めします。

### 詳細 SMPP トレースの無効化 {#sms-disable-smpp}

すべてのチェックが完了したら、過剰なログが生成されないように、詳細な SMPP トレースを無効にします。

## SMS トラブルシューティング {#sms-troubleshooting}

### 一般的なトラブルシューティング手順 {#sms-general-troubleshooting}

SMS コネクタには、SMPP プロバイダー、Adobe、ユーザーの 3 つのエンティティが含まれます。
SMS の主なエキスパートは SMPP プロバイダーなので、SMS トラフィックに関連するすべての問題（接続の問題、メッセージの消失、エンコーディングの問題、国別のルールなど）に関与する必要があります。

#### 専用プロセスを有効にする {#sms-dedicated-process}

>[!IMPORTANT]
>
>すべてのアクティブな SMS アカウントで **[!UICONTROL 専用のプロセスを使用してメッセージを送信]** が有効になっていることを確認します。

古い（MTA ベースの）コネクタ（専用プロセスが無効）に問題がある場合は、専用プロセスコネクタへの移行を検討する必要があります。 パフォーマンスと安定性がはるかに向上し、ログのフィードバックも大幅に向上しています。

#### 異なる外部アカウント間の競合 {#sms-conflict-external-accounts}

インスタンスに複数の SMS 外部アカウントがある場合は、アカウント間の競合が問題の原因になっていないことを確認します。

問題の原因となっている外部アカウントを特定するには、次の手順に従います。

1. すべての外部アカウントを無効にする
1. 1 つの外部アカウントを有効にする
1. 問題を再現してみる
1. このアカウントで問題が発生しない場合は、そのアカウントを無効にして、次のアカウントで手順 2 に進みます。 すべてのアカウントを個別に確認すると、次の 2 つのシナリオが考えられます。

**その問題は 1 つまたは複数のアカウントで発生した**

この場合、各アカウントに別々にその他のトラブルシューティング手順を適用できます。ネットワークトラフィックとログの量を減らすには、アカウントの診断中に他のアカウントを無効にすることをお勧めします。

**1 つのアカウントのみアクティブの場合は、問題は発生しなかった**

アカウント間で競合が発生しています。Adobe Campaignではアカウントは個別に扱われますが、プロバイダーは単一のアカウントとして扱うことができます。

*すべてのアカウントで異なるログイン/パスワードの組み合わせを使用している*
プロバイダー側の競合の可能性を診断するには、プロバイダーに問い合わせる必要があります。

*一部の外部アカウントは、同じログイン/パスワードの組み合わせを共有しています*
プロバイダーは、BIND PDU がどの外部アカウントからのものかを判断する方法がないので、複数のアカウントからのすべての接続を 1 つのアカウントとして扱うので、おそらく 2 つのアカウントで MO と SR をランダムにルーティングし、一見ランダムな問題を引き起こします。

プロバイダが同じログイン/パスワードの組み合わせに対して複数のショートコードをサポートしている場合は、そのショートコードをどこに BIND PDU に入れるかを尋ねる必要があります。 この情報は、SUBMIT_SM ではなく、BIND PDU 内に配置する必要があります。これは、BIND PDU が、MO を正しくルーティングできる唯一の場所であるためです。

上記の [ 各種 PDU の情報 ](#pdu) の節を参照して、BIND PDU で使用できるフィールドを調べます。通常、短いコードを *address_range* に入れますが、これには、プロバイダーからの特別なサポートが必要です。 複数のショートコードを個別にルーティングする方法については、担当者にお問い合わせください。

Adobe Campaignは、同じ外部アカウントで複数のショートコードを正常に処理できるようサポートしています。そのため、多くの場合、すべてのトラフィックに対して 1 つのアカウントを使用するだけで正常に機能します。

#### 外部アカウントの動作が停止しました {#sms-external-account-not-working}

一般に、SMPP 接続は時間の経過と共に非常に安定する傾向があり、正しく設定されると、引き続き機能します。

* コネクタが最近変更されたかどうか、および誰によって変更されたかを調査します（グループとして外部アカウントを確認します）。
* システムがアップグレードされたかどうか、およびアップグレードされた時期を調べます。
* SMS に影響を与えるパッケージが最近アップグレードされた可能性があるかどうかを調べます。

これらのチェックのいずれも根本原因とならない場合は、プロバイダに問い合わせてください。 プロバイダーがプラットフォームを更新する際の、コネクタの動作が若干異なる場合があります。 これにより、微調整された設定が解除され、リグレッションが発生する可能性があります。

プロバイダーと連絡を取り合うことをお勧めします。多くの場合、大きな変更を事前に伝えます。

#### ミッドソーシングに関する問題（ホスト）  {#sms-issue-hosted}

* 問題がミッドソーシング環境で発生した場合は、配信と broadLog がミッドソーシングサーバー上で正しく作成および更新されていることを確認します。 そうでない場合、問題は SMS の問題ではありません。
* ミッドオペレーター名が小文字で厳密に指定されていることを確認してください。指定されていない場合、配信は保留中ステータスのままになります。
* すべてがミッドサーバーで動作し、SMS が適切に送信されているが、マーケティングインスタンスが適切に更新されていない場合は、ミッド同期の問題があります。

#### プロバイダーに接続する際の問題 {#sms-issue-connection}

* BIND PDU が 0 以外の *command_status* コードを返す場合（エラーがあることを意味します）、または BIND_RESP PDU がない場合は、その理由をプロバイダーに問い合わせてください。
* プロバイダーへの TCP 接続を確立できるように、ネットワークが正しく設定されていることを確認してください。
* プロバイダーに、Adobe Campaign インスタンスの IP アドレスが正しく許可されているかどうかを確認するように依頼します（ほとんどのプロバイダーはこの IP アドレスを必要とします）。
* 外部アカウント設定を確認します。 一部のフィールドの値について不明な点がある場合は、プロバイダーに問い合わせてください。
* 接続に成功したが不安定な場合は、[ 不安定な接続に関する問題 ](#unstable-connections) を確認してください。 セクションを下にします。
* 接続の問題を診断するのが難しい場合は、ネットワークキャプチャを使用すると多くの情報が得られます。 問題が発生している間は、ネットワークキャプチャを同時に実行して、効率的に分析できるようにします。 また、問題が発生する正確な時刻を記録しておくと、ネットワークキャプチャで問題を見つけやすくなります。

#### 不安定な接続に関する問題 {#unstable-connections}

**不安定な接続を診断する方法：**

次のいずれかの場合、接続は不安定と見なされます。

* 接続が 1 時間未満で続く。
* SMS プロセスを再起動すると、一時的に問題が「修正」されます。 不安定な接続トリガーのスロットリング、SMS プロセスの再起動によってスロットリングがクリアされた後、根本原因が見つかるまで再び発生する可能性があります。
* プロバイダーは UNBIND PDU を送信します。 プロバイダーは、通常の操作では UNBIND PDU を送信しないでください。
* *enquire_link* は、Campaign 側またはプロバイダー側でタイムアウトします。 この場合、0 以外のエラーコードを持つ ENQUIRE_LINK_RESP が表示される場合とされない場合があります。
* 多くの BIND PDU があります。 1 日に数個を超えてはいけません（接続数によって異なります）。 1 時間あたり、1 接続あたり、1 つ以上の BIND PDU がアラートを生成する必要がある。

**接続の安定性の問題を修正する方法：**

* 不安定な接続は根本的な原因になることはめったにありません。多くの場合、他の問題が何らかの方法で切断を引き起こすことが原因です。 根本原因の特定を優先する必要があります。
* 詳細 SMPP トレースを有効にします。接続が再開したときに何が起きているかを確認する必要があります。
* プロバイダーが UNBIND PDU を送信する場合、何か問題が発生している可能性があります。 なぜ UNBIND を送るのか尋ねれば、おそらく根本原因を引き起こすでしょう。
* ネットワークのキャプチャをおこなうことが、接続が閉じられた状態を確認する唯一の方法である場合があります。
* プロバイダが（TCP FIN または TCP RST パケットを送信して）接続を閉じた場合は、その理由を問い合わせてください。 これにより、問題の根本原因がわかります。
* プロバイダーがクリーンなエラー（エラーコードを含む DELIVER_SM_RESP など）を送信した後に接続を閉じた場合、他の種類のメッセージが送信されないようにし、MTA スロットルをトリガーにするので、プロバイダーはコネクタを修正する必要があります。 これは、接続を閉じると MT と SR の両方に影響を与えるトランシーバモードで特に重要です。
* タイムアウト（BIND タイムアウト、SUBMIT_SM タイムアウト）がある場合、Campaign はそのプロバイダーに対してメッセージを送信するのが早すぎる可能性があります。 *max MT のスループット* を下げて、問題が解決するかどうかを確認してください。

#### MT（エンドユーザーに送信される通常の SMS）の送信時の問題

* 接続が安定していることを確認します。SMPP 接続は、継続的に少なくとも 1 時間アップ状態に保たれます。 上記の「不安定な接続に関する問題」の節を参照してください。
* SMS プロセスを再起動することで、MT の送信が少しの間機能しなおした場合は、接続が不安定なためにスロットルが発生している可能性があります。 上記の「不安定な接続に関する問題」の節を参照してください。
* 広範ログが存在し、ステータスと日付が正しいことを確認します。そうでない場合、SMS の問題ではなく、配信の問題または配信準備の問題です（これはこのドキュメントの範囲外です）。
* SMS コネクタがプロバイダーの機器に実際にバインドされていることを確認します。すべてのシステムが正しく通信されていることを確認するために、プロバイダーにフィードバックを求めます。バインドプロセスについては、BIND_TRANSMITTER および BIND_TRANSCEIVER PDU を参照してください。 適切なトラブルシューティングをおこなうために、SMPP トレースを有効にする必要がある場合があります。
* SMPP トレースを有効にした状態で、SUBMIT_SM PDU に適切な情報が含まれていることを確認します（上記のドキュメントを参照）。
* プロバイダーが「OK」の値を持つ SUBMIT_SM_RESP PDU （コード 0）で応答することを確認します。 PDU が適切な遅延で到着していることを確認します。1 秒を超えるものは疑わしく、プロバイダーに相談する必要があります。通常、100 ミリ秒未満で到着します。
* これらの手順がすべて正常に動作する場合は、問題がプロバイダー側にある可能性が高いです。プロバイダーのプラットフォームでトラブルシューティングをおこなう必要があります。
* 動作してもスループットが異なる場合は、送信ウィンドウを調整し、MT スループットを下げてみてください。MT スループットを調整するには、プロバイダーに依頼する必要があります。Campaign ではメッセージを非常に迅速に送信できるので、プロバイダーの機器でパフォーマンスの問題が発生する可能性があります。

#### MT の重複（同じ SMS が連続して複数回送信される）

重複は多くの場合、再試行が原因で発生します。メッセージを再試行する際に重複が発生するのは通常なので、再試行の根本原因を排除することに集中する必要があります。

* 60 秒間隔（またはその他の疑わしい「通常」間隔）で重複が送信された場合、これはおそらくプロバイダー側の問題であり、送信する SUBMIT_SM_RESP が不十分です。
* 多くの BIND/UNBIND が表示される場合、接続が不安定です。重複するメッセージの問題を解決する前に、[ 不安定な接続の問題 ](#unstable-connections) の節を参照して、解決策を見つけてください。
* すべての SUBMIT_SM PDU の直後に、SUBMIT_SM_RESP が一致していることを確認します。 そうでない場合や SUBMIT_SM_RESP が遅すぎる場合は、問題はプロバイダー側にあります。

再試行がある場合の重複の量の削減：

* *送信ウィンドウ* を下げます。 送信ウィンドウは、SUBMIT_SM_RESP 待ち時間に対応する大きさにする必要がありますが、大きすぎるわけではありません。 この値は、ウィンドウサイズが上限に達した状態でエラーが発生した場合に複製できるメッセージの最大数を表します。

#### SR（配信レシート）を処理する際の問題

* SR のトラブルシューティングをおこなうには、SMPP トレースを有効にする必要があります。
* DELIVER_SM PDU がプロバイダーから送信され、整形式であることを確認します。
* Campaign が成功した DELIVER_SM_RESP PDU をタイムリーに返すことを確認します。 これにより、SR が SMS プロセスによる遅延処理のために providerMsgStatus テーブルに挿入されたことが保証されます。

DELIVER_SM PDU が正常に確認されない場合は、次の点を確認する必要があります。

* 外部アカウントでの id 抽出およびエラー処理に関連する正規表現を確認します。 場合によっては、DELIVER_SM PDU の内容に対してそれらを検証する必要があります。
* エラーが broadLogMsg テーブルに適切にプロビジョニングされていることを確認します（Campaign ドキュメントで詳しく説明しています）。

DELIVER_SM PDU が ACC 拡張 SMPP コネクタによって確認されたが、broadLog が適切に更新されていない場合は、上記の MT、SR、broadlog エントリの照合の節で説明されている ID 紐付けプロセスを確認します。

すべての問題を修正したものの、無効な SR がプロバイダーのバッファに残っている場合は、「無効な ID 確認数」オプションを使用してスキップできます。このオプションは慎重に使用する必要があり、バッファがクリーンになった後、できるだけ早く 0 にリセットする必要があります。

SR 処理が遅い場合は、BroadLogMsg テーブルで最も一般的なステータスメッセージを絞り込みます。

一部の SR のみが受信され、すべてではない場合は、テストシステムなど、他のシステムがプロバイダーのアカウントに接続していないことを確認します。 SR は任意の接続でルーティングできるので、一部の SR はこの別のシステムにルーティングされる場合があります。 プロバイダは、この他のシステムがアカウントに接続している場所を見つけるのに役立つ場合があります。

#### MO （および強制隔離/自動応答）を処理する際の問題

* テスト中に SMPP トレースを有効にします。TLS を有効にしない場合は、MO のトラブルシューティング時にネットワークキャプチャを行って、PDU に正しい情報が含まれ、正しくフォーマットされていることを確認する方が常に良いでしょう。
* ネットワークトラフィックをキャプチャしたり、SMPP トレースを分析したりする場合は、必ず MO およびその応答 MT （応答が設定されている場合）との会話全体をキャプチャします。
* MO （DELIVER_SM PDU）がトレースに表示されない場合は、問題がプロバイダー側にあると確信できます。 プロバイダーのプラットフォームでトラブルシューティングをおこなう必要があります。
* DELIVER_SM PDU が表示された場合は、正常な DELIVER_SM_RESP PDU （コード 0）で Campaign によって確認されていることを確認します。 この応答は、すべての処理ロジックが Campaign （自動応答および強制隔離）によって適用されていることを保証します。 そうでない場合は、SMS プロセスログでエラーメッセージを検索します。
* 自動返信が有効な場合は、SUBMIT_SM がプロバイダに送信されたことを確認します。 送信されない場合は、必ず SMS プロセスログにエラーメッセージが表示されます。
* 応答を含む SUBMIT_SM MT PDU がトレースで見つかったが、SMS が携帯電話に届かない場合は、問題がおそらくプロバイダー側にある可能性があるので、トラブルシューティングについてプロバイダーに問い合わせる必要があります。

#### 配信の準備中に、強制隔離された受信者（自動応答機能によって強制隔離済み）が除外されない問題 

* 電話番号の形式が、強制隔離テーブルと配信ログで完全に同じであることを確認します。そうでない場合、国際電話番号の形式のプラスプレフィックスに問題がある場合は、上記の「完全な電話番号を送信」設定を参照してください。
* ショートコードを確認：受信者のショートコードが外部アカウントで定義されたショートコードと同じか、空（空=任意のショートコード）の場合に除外が発生します。 Campaign インスタンス全体で 1 つのショートコードのみを使用する場合は、すべての「ショートコード」フィールドを空のままにしておく方が簡単です。

#### エンコードの問題  {#sms-encoding-issues}

エンコーディングの問題は、SMS でよく発生します。 いくつかの基本的な手順を示します。

**手順 1：プロバイダーに問い合わせる**

プロバイダーは、SMS の仕組みを知っているエキスパートです。 彼らに連絡を取り、何が問題なのかを彼らと見てください。 彼らは、問題が自分の側にあるのか、Campaign にあるのかを知ることができるはずです。 Campaign に問題がある場合は、間違っているフィールドを正確に伝えることができるので、非常に役立ちます。

**手順 2：メッセージの内容を理解する**

メッセージの内容を知っておく必要があります。 その文章は簡単に聞こえるかもしれないが、しかし実際はそうではない。 Unicode では、類似した文字のバリアントが非常に多く、Campaign ではすべてを処理できません。

最も一般的な問題の原因は、通常の文字をタイポグラフィ的に正しいバージョンに変更するワードプロセッサからのコピー&amp;ペーストです。つまり、スペースが改行されないスペースに変更され、二重引用符が開閉の引用符に変更され、マイナス記号がさまざまな種類のハイフンに変更されます。

テスト時はメッセージをコピー＆ペーストせずに、必ずインターフェイスに直接入力してください。

**16 進数で威嚇しないでください**。 16 進数は奇妙で不自然に見えますが、非常に明確な品質があります。類似した文字の違いがわかります。 小文字の L、大文字の I、O、0、あらゆる種類の引用符、非ラテン エンコーディング、または異なる種類のスペースは、すべて同じように見える（またはまったく表示されない）ことがあります。 16 進数はすべてを示し、ものを比較するのに役立ちます。

Unicode を 16 進数に変換するには、オンラインツールを使用します。

**チケットを開く場合** エンコードの問題に関して、プロバイダーまたは Campaign サポートのいずれを使用しているかに関わらず、入力した内容と表示される内容の 16 進数バージョン **を含** ます。

**手順 3：送信の内容を理解する**

使用するエンコーディングを決定し、その文字テーブルをオンラインで検索します。送信する文字がターゲットコードページで実際に使用できることを確認します。data_coding フィールドが正しく、ユーザーとプロバイダーが期待する内容に一致していることを確認します。

**手順 4：実際に送信した内容を理解する**

プロバイダーに送信するバイトを正確に確認するには、コネクタのデバッグ出力が必要です。エンコードの問題は SUBMIT_SM PDU に現れるので、必ずキャプチャしてください。 ログ内で見つけやすい明確なメッセージを送信します。

テストの際には、遠慮なく様々な種類の特殊文字を送信してください。 例えば、GSM7 エンコーディングでは、16 進数形式で非常に明確に区別される拡張文字があるので、他のエンコーディングには表示されないので、見つけやすくなっています。

#### パフォーマンスの問題 {#sms-performance-issues}

>[!NOTE]
>
>パフォーマンスは非常に広範なトピックです。 この節では、規模を拡大したり、他の大きなプロジェクトを実行したりする前に、いくつかの基本的なチェックを行います。

**MT の送信中のパフォーマンスの問題**

* 外部アカウントの [ スループットと遅延 ] セクションのすべての設定が正しく、プロバイダで許可されている設定と一致していることを確認してください。
* 再試行がないことを確認します。
* プロバイダーのインフラストラクチャが飽和状態になっていないことを確認します。 RESP PDU の RMSGFUL または RTHROTTLED エラーを確認します。
* serverConf 設定を確認します。 デフォルト値から開始して、パラメーターをゆっくりと 1 つずつ増やします。
* 読み込み中に SMS プロセスが常に再起動しないことを確認します。 その場合は、serverConf ファイルの *maxSMSMemoryMb*、*maxProcessMemoryAlertMb* および *maxProcessMemoryWarningMb* の値を増やす必要がある可能性があります。

**SR の受信中のパフォーマンスの問題**

プロバイダー側でバッファーの過負荷に関して不満がある場合、これは Campaign が SR を十分な速度で受信できないことが原因である可能性があります。

* インスタンスデータベースがオーバーロードされていないことを確認します。 SR 処理はデータベースのパフォーマンスに大きく依存します。
* プロバイダー側の DELIVER_SM の送信時間を増やすように依頼します。 serverConf の *batchUpdateSize* 設定と同じ大きさにするのが理想です。

### SMS の問題を報告する際に含めるべき要素

SMS の問題（Adobe Campaignに対するサポートチケットを開く場合でも、SMS プロバイダーに対するサポートチケットを開く場合でも、問題に関するあらゆる種類のコミュニケーションの場合でも）にサポートを求める場合は、適切に認定されていることを確認するために、少なくとも次の情報を含める必要があります。 適切に見極められた課題は課題解決の鍵となるため、もう少し時間をかけて状況を把握し、有意義な情報を提供することは、効率の大幅な向上につながります。

* 問題が発生している間に詳細 SMPP メッセージを有効にします。 ほとんどの SMS の問題は、これなしでは実質的に解決できません。
* 問題が SMS トラフィックに関連している場合は、まずプロバイダーに問い合わせてください。彼らは最も知識が豊富で、彼らのプラットフォームは通常、SMS トラフィックの問題をリアルタイムで効率的に診断するのに適しています。
* 問題についての簡潔で事実に即した説明を含めます。
* 期待される結果の説明を含めます。
* プロバイダーからのすべてのフィードバックを含めます。
* 関連するログやネットワークキャプチャを含めます。キャプチャを行う場合は、キャプチャ中に問題を再現してください。再現しないと役に立ちません。
* ログ、トレース、またはキャプチャを含める場合は、問題が発生したときのファイル内の正確な場所と、作業中の例がある場合はその例の正確な場所を特定します。 キャプチャやトレースは大きくて見るのが面倒な場合があるので、情報を見つけるのに役立つものはすべて役立ちます。
* メッセージ、PDU またはログを参照する場合は、他のユーザーが見つけやすいように、タイムスタンプを明確に記述します。
* テスト環境で問題を再現してみてください。設定が不明な場合は、テスト環境で試して、SMPP トレースの結果を確認してください。通常、実稼働環境の問題を直接報告するよりも、テスト環境で問題を再現して報告する方が効果的です。
* プラットフォーム上で行われた変更や微調整を含めます。小さな変更でも、大きな影響を与える可能性があります。 また、プロバイダー側でおこなった可能性のある変更も含めます。

#### ネットワークキャプチャはどのような場合に役立ちますか？

ネットワークキャプチャは必ずしも必要ではありません。 多くの場合、詳細な SMPP メッセージで十分です。 次に、ネットワークキャプチャが作業に値するかどうかを判断するのに役立つガイドラインを示します。

* 接続に問題があるが、詳細メッセージに BIND_RESP PDU が表示されない。
* エラーメッセージを伴わない原因不明の切断（低レベルのプロトコルエラーを検出した場合のコネクタの動作）。
* プロバイダはバインド解除/切断プロセスについて文句を言う。
* オプションの TLV フィールドにエンコーディングの問題があります。
* トラフィックが異なる接続間で混在している疑いがあります。

他のすべての状況では、最初に詳細 SMPP メッセージを分析し、詳細ログに情報がないことが明らかな場合にのみネットワークキャプチャをリクエストします。

#### ネットワークキャプチャが役に立たないのは、どのような場合ですか？

ネットワークトラフィックのキャプチャは、役に立たない場合や、時間の無駄に過ぎない場合もあります。 最も一般的な状況を次に示します。

* TLS が有効：定義上、TLS トラフィックは暗号化されるため、キャプチャできません。
* パフォーマンスの問題：ログにパフォーマンスの問題を追跡するために必要なすべての情報が含まれます。
* タイミングの問題（再試行タイミング、enquire_link 期間、スループットキャッピングなど）
* SR 解析と処理：詳細ログは、より多くのコンテキストを提供し、より適切な表示を提供します。
* MO 処理（自動応答、強制隔離）
* 実際の SMPP トラフィックに関係しないエラー：配信の準備、Message Center API の問題、ワークフローの問題など
