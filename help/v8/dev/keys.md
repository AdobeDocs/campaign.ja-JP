---
product: Adobe Campaign
title: 'Campaign における鍵の管理 '
description: 鍵の管理の概要
source-git-commit: 99a1381a0d5cef38eb708dbe6e3e8029e6ff3953
workflow-type: tm+mt
source-wordcount: '676'
ht-degree: 97%

---

# 鍵の管理と単一性{#key-management}

Campaign v8 では、プライマリキーはユニバーサル固有識別子（UUID）であり、文字列です。 UUID を作成するには、スキーマのメイン要素に **autouuid** 属性と **autopk** 属性を含め、**true** に設定する必要があります。

Adobe Campaign v8 には、コアデータベースとして Snowflake が付属しています。Snowflake データベースの分散アーキテクチャには、テーブル内のキーの単一性を管理するメカニズムはありません。Adobe Campaign データベース内のキーの一貫性は、エンドユーザーが確保する必要があります。

リレーショナルデータベースの一貫性を維持するには、キー（特にプライマリキー）の重複を避けることが必須です。 プライマリキーが重複すると、**クエリ**、**紐付け**、**データの更新**&#x200B;などのデータ管理ワークフローのアクティビティに問題を引き起こします。

アドビが推奨するベストプラクティスは、重複したキーがデータベースに読み込まれた場合を想定し、データ管理プロセスの一部として[検出](#detect-duplicates)して[訂正](#correct-duplicates)する戦略を採用することです。

## 重複の検出{#detect-duplicates}

Campaign に付属の新しいガードレールでは、配信の準備中に重複 UUID をオーディエンスから自動的に削除します。この新しいメカニズムは、配信の準備中にエラーが発生するのを防ぎます。

>[!CAUTION]
>
>重複したキーはUUIDに制限されません。 これは、カスタムテーブルで作成されたカスタムキーを含む、IDを持つで発生する可能性があります。

Campaign のユーザーは、配信ログに「キーが重複しているため、一部の受信者がメインターゲットから除外されます」という情報が記録されるのを確認できます。その際、次の警告が表示されます。`Exclusion of duplicates (based on the primary key or targeted records)`

![](assets/delivery-log-duplicates.png)

重複が発生した場合、重複したキーを特定するワークフローを実施します。 その後、これらのキーを修正できます。 手順は次のとおりです。

1. 新しいワークフローを作成します。

   ![](assets/new-wf.png)

1. **クエリ**&#x200B;アクティビティを追加します
1. **受信者**&#x200B;テーブルを選択します

   ![](assets/add-query-on-rcp.png)

1. **重複の除外**&#x200B;アクティビティを追加し、プライマリキー（UUID）の重複を排除します。 重複の 1 つを保持し、「 **補集合を生成** 」オプションをオンにして、重複していた鍵のアウトバウンドトランジションを作成します。

   ![](assets/deduplicate.png)

1. リスト更新アクティビティを使用して、重複をリストに保存します。

   ![](assets/list-update.png)

これで、重複した受信者にリストから直接アクセスできます。 トランジションに、重複した行が 1 つしか含まれていない場合でも、すべての重複がリストに記録されます。


## 重複を修正{#correct-duplicates}

重複を修正するには、Campaign データを更新する必要があります。 アクションのタイプは、重複の特性と実装に密接に結びついています。異なる緩和戦略（削除、結合または更新）を必要とする複数のケースに直面する場合があります。

>[!IMPORTANT]
>
>プライマリキーが重複していると、組み込みのワークフローアクティビティを使用して特定の行の選択や更新を行えなくなります。 UUID の重複が原因で、データの重複排除に失敗し、データベースの整合性に影響を与える可能性があります。 そのため、重複を修正することを強くお勧めします。

例：

* **ケース 1** - 同じ UUIDと同じプロファイル情報（同じメール、名前など）を持つ重複した受信者：受信者は、「実際に」重複していると考えられ、軽減策は重複の 1 つを削除することになります。
もう 1 つのアプローチは、片方の受信者の情報を他方の受信者に結合することです。

* **ケース 2** - 同じ UUID を持つが、プロファイル情報（メールや名前など）が異なる重複した受信者：
別のプロファイルであると考えられるので、Campaign データベースに両方を保持することが推奨されます。つまり、新しい UUID を生成して、重複の片方を更新する方がよいでしょう。 詳しくは、[この例](#deduplicate-sample)を参照してください。

使用する軽減策に応じて、いつでも別のワークフローからリストにクエリを実行し、必要に応じて更新を適用できます。 詳しいガイダンスについては、アドビにお問い合わせください。

### 重複排除のサンプル{#deduplicate-sample}

受信者が重複している場合は、Campaign データベースに両方のレコードを保持できます。 その場合は、いずれか 1 つを新しい UUID で更新する必要があります。

クラウドデータベースで SQL 更新クエリを実行するには、**SQL データ管理**&#x200B;ワークフローアクティビティを使用して、次の SQL 更新を実行します。

```sql
update nmsrecipient set urecipientid = uuid_string()
where semail = 'bretta37@adobe.com'
and urecipientid = 'c04d93f2-6012-4668-b523-88db1262cd46';
```

![](assets/sql-data-management.png)

選択した行を新しい UUID で更新したら、インターフェイスで更新した行を見ると、UUID が期待どおりに更新されていることを確認できます。**重複を検出**&#x200B;ワークフローを実行してデータベース内の重複を検出することもできます。詳しくは、[こちら](#detect-duplicates)を参照してください。
